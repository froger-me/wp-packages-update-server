jQuery(document).ready(function(s){if(-1!==location.href.indexOf("action=")){var e=window.location.href.split("?");e[1]=e[1].replace("action=","action_done="),history.pushState(null,"",e.join("?"))}function i(e){if(s.isPlainObject(e)){if(s("#wppus_license_id").html(e.id),s("#wppus_license_key").val(e.license_key),s("#wppus_license_date_created").val(e.date_created),s("#wppus_license_max_allowed_domains").val(e.max_allowed_domains),s("#wppus_license_owner_name").val(e.owner_name),s("#wppus_license_registered_email").val(e.email),s("#wppus_license_owner_company").val(e.company_name),s("#wppus_license_transaction_id").val(e.txn_id),s("#wppus_license_package_slug").val(e.package_slug),s("#wppus_license_status").val(e.status),s("#wppus_license_package_type").val(e.package_type),"0000-00-00"!==e.date_expiry&&s("#wppus_license_date_expiry").val(e.date_expiry),"0000-00-00"!==e.date_renewed&&s("#wppus_license_date_renewed").val(e.date_renewed),0<e.allowed_domains.length){var p=s(".wppus-domains-list"),n=p.find("li").clone();n.removeClass("wppus-domain-template"),s.each(e.allowed_domains,function(e,a){var i=n.clone();i.find(".wppus-domain-value").html(a),p.append(i)}),s(".wppus-no-domain").hide(),p.show()}}else s("#wppus_license_key").val(s("#wppus_license_key").data("random_key")),s("#wppus_license_date_created").val((new Date).toISOString().slice(0,10)),s("#wppus_license_max_allowed_domains").val(1)}function p(e,a){e.is(":visible")||e.slideDown(100,function(){a(e),e.find(".inside").animate({opacity:"1"},150)})}s(".wppus-wrap .wp-list-table .delete a").on("click",function(e){window.confirm(Wppus.deleteRecord)||e.preventDefault()}),s(".wppus-delete-all-packages").on("click",function(e){window.confirm(Wppus.deletePackagesConfirm)||e.preventDefault()}),s(".wppus-delete-all-licenses").on("click",function(e){window.confirm(Wppus.deleteLicensesConfirm)||e.preventDefault()}),s(".ajax-trigger").on("click",function(e){e.preventDefault();var a=s(this),i={type:a.data("type"),nonce:s("#wppus_plugin_options_handler_nonce").val(),action:"wppus_force_"+a.data("action")};a.attr("disabled","disabled"),s.ajax({url:Wppus.ajax_url,data:i,type:"POST",success:function(e){if(!e.success){var i="";s.each(e.data,function(e,a){i+=a.message+"\n"}),window.alert(i)}a.removeAttr("disabled"),e.data&&e.data.btnVal&&a.val(e.data.btnVal)},error:function(e,a){Wppus.debug&&console.log(a)}})}),s("#wppus_prime_package_slug").on("keyup",function(){0<s(this).val().length?s("#wppus_prime_package_trigger").removeAttr("disabled"):s("#wppus_prime_package_trigger").attr("disabled","disabled")}),s("#wppus_prime_package_trigger").on("click",function(e){e.preventDefault();var a=s(this),i={slug:s("#wppus_prime_package_slug").val(),nonce:s("#wppus_plugin_options_handler_nonce").val(),action:"wppus_prime_package_from_remote"};a.attr("disabled","disabled"),a.next().css("visibility","visible"),s.ajax({url:Wppus.ajax_url,data:i,type:"POST",success:function(e){if(e.success)window.location.reload(!0);else{var i="";s.each(e.data,function(e,a){i+=a.message+"\n"}),a.removeAttr("disabled"),a.next().css("visibility","hidden"),window.alert(i)}},error:function(e,a){Wppus.debug&&console.log(a)}})}),s("#wppus_manual_package_upload").on("change",function(){var e=s(this);0<e.prop("files").length?(s("#wppus_manual_package_upload_filename").val(e.prop("files")[0].name),s("#wppus_manual_package_upload_trigger").removeAttr("disabled")):(s("#wppus_manual_package_upload_filename").val(""),s("#wppus_manual_package_upload_trigger").attr("disabled","disabled"))}),s("#wppus_manual_package_upload_dropzone").on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("drop",function(e){var a=s("#wppus_manual_package_upload");a.prop("files",e.originalEvent.dataTransfer.files),a.trigger("change")}),s(".manual-package-upload-trigger").on("click",function(e){e.preventDefault();var a=s(this),i=new FormData,p=!0,n=s("#wppus_manual_package_upload").prop("files")[0];a.attr("disabled","disabled"),a.next().css("visibility","visible"),void 0!==n&&void 0!==n.type&&void 0!==n.size&&void 0!==n.name?(-1===s.inArray(n.type,["multipart/x-zip","application/zip","application/zip-compressed","application/x-zip-compressed"])&&(window.alert(Wppus.invalidFileFormat),p=!1),0===n.size&&(window.alert(Wppus.invalidFileSize),p=!1),/^([a-zA-Z0-9\-\_]*)\.zip$/gm.test(n.name)||(window.alert(Wppus.invalidFileName),p=!1)):(window.alert(Wppus.invalidFile),p=!1),p?(i.append("action","wppus_manual_package_upload"),i.append("package",n),i.append("nonce",s("#wppus_plugin_options_handler_nonce").val()),s.ajax({url:Wppus.ajax_url,data:i,type:"POST",cache:!1,contentType:!1,processData:!1,success:function(e){if(e.success)window.location.reload(!0);else{var i="";s.each(e.data,function(e,a){i+=a.message+"\n"}),a.removeAttr("disabled"),window.alert(i)}},error:function(e,a){Wppus.debug&&console.log(a)}})):(a.next().css("visibility","hidden"),a.removeAttr("disabled"))}),s("#add_license_trigger").on("click",function(){p(s("#wppus_license_panel"),function(){i(),s("#wppus_license_action").val("create"),s(".wppus-edit-license-label").hide(),s(".wppus-license-show-if-edit").hide(),s(".wppus-add-license-label").show(),s(".open-panel").attr("disabled","disabled"),s(".wppus-licenses-table .open-panel").hide(),s("html, body").animate({scrollTop:s("#wppus_license_panel").offset().top-s("#wpadminbar").height()-20},500)})}),s(".wppus-licenses-table .open-panel .edit a").on("click",function(e){e.preventDefault();var a=JSON.parse(s(this).closest("tr").find('input[name="license_data[]"]').val());p(s("#wppus_license_panel"),function(){i(a),s("#wppus_license_action").val("update"),s(".wppus-edit-license-label").show(),s(".wppus-license-show-if-edit").show(),s(".wppus-add-license-label").hide(),s(".open-panel").attr("disabled","disabled"),s(".wppus-licenses-table .open-panel").hide(),s("html, body").animate({scrollTop:s("#wppus_license_panel").offset().top-s("#wpadminbar").height()-20},500)})}),s("#wppus_license_cancel, .close-panel.reset").on("click",function(){var e,a;s("html, body").animate({scrollTop:s(".wppus-wrap").offset().top-s("#wpadminbar").height()-20},150),e=s("#wppus_license_panel"),a=function(){s("#wppus_license").trigger("reset"),s("wppus_license_values").val(""),s("wppus_license_action").val(""),s(".open-panel").removeAttr("disabled"),s(".wppus-licenses-table .open-panel").show(),s("#wppus_license_id").html(""),s(".wppus-domains-list li:not(.wppus-domain-template)").remove(),s(".wppus-no-domain").show(),s("label.wppus-license-error").hide(),s(".wppus-license-error").removeClass("wppus-license-error")},e.is(":visible")&&e.slideUp(100,function(){e.find(".inside").css({opacity:"0"}),a(e)})}),s.validator&&(s.validator.methods.licenseDate=function(e,a){return this.optional(a)||/[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/.test(e)},s.validator.methods.slug=function(e,a){return this.optional(a)||/[a-z0-9-]*/.test(e)},s("#wppus_license").validate({errorClass:"wppus-license-error",rules:{wppus_license_key:{required:!0},wppus_license_package_slug:{required:!0,slug:!0},wppus_license_registered_email:{required:!0,email:!0},wppus_license_date_created:{required:!0,licenseDate:!0},wppus_license_date_expiry:{licenseDate:!0},wppus_license_date_renewed:{licenseDate:!0},wppus_license_max_allowed_domains:{required:!0}},submitHandler:function(e){var a=s(".wppus-domains-list li:not(.wppus-domain-template) .wppus-domain-value"),i={id:s("#wppus_license_id").html(),license_key:s("#wppus_license_key").val(),max_allowed_domains:s("#wppus_license_max_allowed_domains").val(),allowed_domains:a.map(function(){return s(this).text()}).get(),status:s("#wppus_license_status").val(),owner_name:s("#wppus_license_owner_name").val(),email:s("#wppus_license_registered_email").val(),company_name:s("#wppus_license_owner_company").val(),txn_id:s("#wppus_license_transaction_id").val(),date_created:s("#wppus_license_date_created").val(),date_renewed:s("#wppus_license_date_renewed").val(),date_expiry:s("#wppus_license_date_expiry").val(),package_slug:s("#wppus_license_package_slug").val(),package_type:s("#wppus_license_package_type").val()};s("#wppus_license_values").val(JSON.stringify(i)),s(".no-submit").removeAttr("name"),e.submit()}})),s("#wppus_license_registered_domains").on("click",".wppus-remove-domain",function(e){e.preventDefault(),s(this).parent().remove(),1<=s(".wppus-remove-domain").length&&s(".wppus-no-domain").show()}),0<s(".wppus-license-date").length&&s(".wppus-license-date").datepicker({dateFormat:"yy-mm-dd"})});