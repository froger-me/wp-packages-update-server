jQuery(document).ready(function(a){function e(a){var e=(new DOMParser).parseFromString(a,"text/html");return e.documentElement.textContent}if(-1!==location.href.indexOf("action=")){var n=window.location.href.split("?");n[1]=n[1].replace("action=","action_done="),history.pushState(null,"",n.join("?"))}a('input[type="password"].secret').on("focus",function(){a(this).attr("type","text")}),a('input[type="password"].secret').on("blur",function(){a(this).attr("type","password")}),a(".wppus-wrap .wp-list-table .delete a").on("click",function(a){var e=window.confirm(WppusAdminMain_l10n.deleteRecord);e||a.preventDefault()}),a(".wppus-delete-all-packages").on("click",function(a){var e=window.confirm(WppusAdminMain_l10n.deletePackagesConfirm);e||a.preventDefault()}),a(".ajax-trigger").on("click",function(n){n.preventDefault();var i=a(this),t=i.data("type"),p={type:t,nonce:a("#wppus_plugin_options_handler_nonce").val(),action:"wppus_"+i.data("action"),data:i.data("selector")?a(i.data("selector")).get().reduce(function(a,e){return a[e.id]="checkbox"===e.type||"radio"===e.type?e.checked:e.value,a},{}):{}};i.attr("disabled","disabled"),a.ajax({url:WppusAdminMain.ajax_url,data:p,type:"POST",success:function(n){if(n.success){if(n.data){t="";a.each(n.data,function(a,n){"btnVal"!==a&&(t+=e(n)+"\n")}),t.length&&window.alert(t)}}else{var t="";a.each(n.data,function(a,n){t+=e(n.message)+"\n"}),window.alert(t)}i.removeAttr("disabled"),n.data&&n.data.btnVal&&i.val(n.data.btnVal)},error:function(a,e){WppusAdminMain.debug&&console.log(e)}})});var i=!1;a("#wppus_prime_package_slug").on("input",function(){0<a(this).val().length&&!i?a("#wppus_prime_package_trigger").removeAttr("disabled"):i||a("#wppus_prime_package_trigger").attr("disabled","disabled")}),a("#wppus_prime_package_trigger").on("click",function(e){e.preventDefault();var n=a(this),t={slug:a("#wppus_prime_package_slug").val(),nonce:a("#wppus_plugin_options_handler_nonce").val(),action:"wppus_prime_package_from_remote"};n.attr("disabled","disabled"),n.next().css("visibility","visible"),i=!0,a.ajax({url:WppusAdminMain.ajax_url,data:t,type:"POST",success:function(e){if(e.success)window.location.reload(!0);else{var t="";a.each(e.data,function(a,e){t+=e.message+"\n"}),i=!1,n.removeAttr("disabled"),n.next().css("visibility","hidden"),window.alert(t)}},error:function(a,e){WppusAdminMain.debug&&console.log(e),i=!1,n.removeAttr("disabled"),n.next().css("visibility","hidden")}})}),a("#wppus_manual_package_upload").on("change",function(){var e=a(this);0<e.prop("files").length?(a("#wppus_manual_package_upload_filename").val(e.prop("files")[0].name),a("#wppus_manual_package_upload_trigger").removeAttr("disabled")):(a("#wppus_manual_package_upload_filename").val(""),a("#wppus_manual_package_upload_trigger").attr("disabled","disabled"))}),a("#wppus_manual_package_upload_dropzone").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("drop",function(e){var n=a("#wppus_manual_package_upload");n.prop("files",e.originalEvent.dataTransfer.files),n.trigger("change")}),a(".manual-package-upload-trigger").on("click",function(e){e.preventDefault();var n=a(this),i=new FormData,t=!0,p=a("#wppus_manual_package_upload").prop("files")[0],o=/^([a-zA-Z0-9\-\_]*)\.zip$/gm,l=["multipart/x-zip","application/zip","application/zip-compressed","application/x-zip-compressed"];n.attr("disabled","disabled"),n.next().css("visibility","visible"),void 0!==p&&void 0!==p.type&&void 0!==p.size&&void 0!==p.name?(-1===a.inArray(p.type,l)&&(window.alert(WppusAdminMain_l10n.invalidFileFormat),t=!1),0===p.size&&(window.alert(WppusAdminMain_l10n.invalidFileSize),t=!1),o.test(p.name)||(window.alert(WppusAdminMain_l10n.invalidFileName),t=!1)):(window.alert(WppusAdminMain_l10n.invalidFile),t=!1),t?(i.append("action","wppus_manual_package_upload"),i.append("package",p),i.append("nonce",a("#wppus_plugin_options_handler_nonce").val()),a.ajax({url:WppusAdminMain.ajax_url,data:i,type:"POST",cache:!1,contentType:!1,processData:!1,success:function(e){if(e.success)window.location.reload(!0);else{var i="";a.each(e.data,function(a,e){i+=e.message+"\n"}),n.removeAttr("disabled"),window.alert(i)}},error:function(a,e){WppusAdminMain.debug&&console.log(e)}})):(n.next().css("visibility","hidden"),n.removeAttr("disabled"))})});